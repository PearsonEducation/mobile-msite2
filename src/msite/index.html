<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>eCollege</title>
		<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<link rel="apple-touch-icon" href="images/icon.png" />
		<link rel="apple-touch-icon-precomposed" href="images/icon.png">
		<link rel="apple-touch-startup-image" href="images/startup.png">
		<link rel="stylesheet" href="css/jquery.mobile-1.0a3.css" />
		<link rel="stylesheet" href="css/msite.css" />
		<link rel="stylesheet" href="css/branding.css" />
		<script type="text/javascript" src="scripts/jquery/jquery-1.5.1.min.js"></script>
		<script type="text/javascript" src="scripts/jquery/jquery.mobile-1.0a3.js"></script>
		<script type="text/javascript" src="scripts/date.js"></script>
		<script type="text/javascript" src="scripts/json2.js"></script>
		<script type="text/javascript" src="scripts/jquery/jquery.mobyConnect.js"></script>
		<script type="text/javascript" src="scripts/jquery/jquery.mobyQueryApi.js"></script>
		<script type="text/javascript" src="scripts/jquery/jquery.mobyActivityManager.js"></script>
		<script type="text/javascript" src="scripts/jquery/jquery.mobyCacheManager.js"></script>
		<script type="text/javascript" src="scripts/jquery/jquery.mobyCourseManager.js"></script>
		<script type="text/javascript" src="scripts/jquery/jquery.mobyDiscussionManager.js"></script>
		<script type="text/javascript" src="scripts/ecollege/AjaxManager.js"></script>
		<script type="text/javascript" src="scripts/ecollege/VariableValidator.js"></script>
		<script type="text/javascript" src="scripts/ecollege/AjaxRequestHeader.js"></script>
		<script type="text/javascript" src="scripts/ecollege/CrossDomainInitializer.js"></script>
		<script type="text/javascript" src="scripts/ecollege/CrossFrameMessage.js"></script>
		<script type="text/javascript" src="scripts/ecollege/CustomEvent.js"></script>
		<script type="text/javascript" src="scripts/ecollege/DomainStatusEvent.js"></script>
		<script type="text/javascript" src="scripts/ecollege/EventDispatcher.js"></script>
		<script type="text/javascript" src="scripts/ecollege/SessionManager.js"></script>
		<script type="text/javascript" src="scripts/ecollege/Utils.js"></script>
		<script type="text/javascript" src="scripts/ecollege/ConfigSettings.js"></script>
		<script type="text/javascript" src="scripts/ecollege/ClientStringManager.js"></script>
		<script type="text/javascript" src="scripts/ecollege/preloadUtils.js"></script>
		<script type="text/javascript" src="scripts/i8ln/en-us/strings.js"></script>
		<script>
			
// Check to see if there is already an access grant of some sort.  If there is, we should forward on to home page.
$().mobyConnect("checkAuth");

$(document).ready(function() {
	
		
	// Initialize cross site connector and session manager,
	// and only once that is done should we do anything else.
	$().mobyConnect("init", {
		crossDomainReadyHandler: function() {
			$().InitPage();
		},
		crossDomainErrorHandler: function() {
			alert('error initializing cross domain functions');
		}
		
	});

});

(function($){
	$.fn.positionBottomOfViewport = function(options) {
		var pos = {
			sTop : function() {
				return window.pageYOffset || document.documentElement && document.documentElement.scrollTop ||	document.body.scrollTop;
			},
			wHeight : function() {
				return window.innerHeight || document.documentElement && document.documentElement.clientHeight || document.body.clientHeight;
			}
		};
	    return this.each(function(index) {
			if (index == 0) {
				var $this = $(this);
				var elHeight = $this.outerHeight();
				var elTop = pos.sTop() + (pos.wHeight()) - (elHeight);
		        $this.css({
					position: 'absolute',
					margin: '0',
					top: elTop,
					left: (($(window).width() - $this.outerWidth()) / 2) + 'px'
				});
			}
		});
	};
})(jQuery);

(function($){
	$.fn.InitPage = function() {
		// Be sure the dropdown menu is hidden each time we change a page
		$(document).bind("pagebeforeshow", function() {
			$("div.layout-header ul").hide();
			$(".layout-header .button-menu").removeClass("menu-active");
		});
		
		// Logout button
		$(".menu-logout").bind("click", function() {
			$.mobile.pageLoading();
			sessionManager.logOut();
			createCookie("access_grant", "", -1);
			$(location).attr("href", "login.html");
			return false;
		});
		
		// Initialize course cache
		// Force a refresh in case this is a new login
		$().mobyCourseManager();
		
	
		$(".layout-header .button-menu").bind("click", function() {
			$(this).siblings("ul").slideToggle(0);
			$(this).toggleClass("menu-active");
			return false;
		});
	
		// Initialize mobi-listview elements
		$(".mobi-listview li").click(function() {
			var strUrl = $(this).attr("id") + ".html";
			$.mobile.changePage(strUrl);
		});
		
		// Initialize click listener for what's due button
		$(".btn-whatsdue").click(function() {
			$("div.subnav a").removeClass("ui-btn-active");
			$(this).addClass("ui-btn-active");
			$(".view-activity").hide();
			$(".view-whatsdue").show();
			
			$(window).unbind("scroll");
		}).click(); // default view for page, set on load.
		
		// Initialize click listener for Activity button
		$(".btn-activity").click(function() {
			$(".btn-whatsdue").removeClass("ui-btn-active");
			$(this).addClass("ui-btn-active");
			$(".view-whatsdue").hide();
			$(".view-activity").show();
			
			// If this view is empty, we need to get the Activities list.
			
			if ($("#pageHome .view-activity .mobi-listview").length === 0) {
			
				$.mobile.pageLoading();
				
				// Fetch the feed and insert into DOM.
				$().mobyActivityManager("toHtml", {
					callbackSuccess: function(objReturn){
						var strFeedHtml = objReturn.strFeedHtml;
						var strHtml = "";
						
						strHtml += '<ul data-role="listview" data-inset="true" class="mobi-listview">';
						strHtml += '<li data-role="list-divider">All Activity</li>';
						strHtml += strFeedHtml;
						
						$("#pageHome .view-activity").html(strHtml);
						$("#pageHome .view-activity .mobi-listview").listview();
						$.mobile.pageLoading(true);
					}
				});
			}
	
			// Add scroll event for infinite scroll and positioning bookmark alert div
			$(window).scroll(function() {
				
				// always position the bookmark popup at the bottom of the viewport
				if ($("#pageHome .bookmark-popup:visible").length > 0){
					$("#pageHome .bookmark-popup").positionBottomOfViewport()
				}
				
				// Infinite scroll
				if (($(window).scrollTop() + 150) >= ($(document).height() - $(window).height())) {
					// Get more goodies!
					$.mobile.pageLoading();
					
					// Fetch the feed and insert into DOM.
					$().mobyActivityManager("toHtml", {
						intStartIndex: configSettings.intCurrentNumberOfActivities,
						intEndIndex: configSettings.intCurrentNumberOfActivities + configSettings.intNumberOfActivities,
						callbackSuccess: function(objReturn) {
							$(".activity-scroll-indicator").remove();
							var strFeedHtml = objReturn.strFeedHtml;
					
							$("#pageHome .view-activity .mobi-listview").append(strFeedHtml);
							$("#pageHome .view-activity .mobi-listview").listview("refresh");
							$.mobile.pageLoading(true);
							configSettings.intCurrentNumberOfActivities += configSettings.intNumberOfActivities;
							if (objReturn.boolAllItems) {
								// All items have been returned and displayed, so unbind the scroll event.
								$(window).unbind("scroll");
							}
						}
					});
		
				}
			})
	
		});
	
	
		// Check to see if we need to display a bookmark popup
		var boolShow = false;
		if (dataStorage.isSupported()) {
			var strPopupShownDate = dataStorage.get("popup-shown-date");
			
			// Show the popup if we've never shown it before, or if we haven't shown it in the last 5 days.
			if (strPopupShownDate == null) {
				boolShow = true;
			}
			else {
				if (Date.parse(strPopupShownDate) > Date.today().add({days: 5})) {
					boolShow = true;
				};
			};
			var boolStandalone = window.navigator.standalone;
			if ((boolStandalone != undefined) && (boolStandalone)) {
				// We're in fullscreen mode.  The only way to get there is by accessing the app via an icon on the home screen of an iOS browser.
				// So if we have that, we don't need to show the popup.
				boolShow = false;
			}
	
		};
		
		if (boolShow) {
			// Show the popup
			var intWidth = $(document).width() - 50;
			var strDevice = detectDevice();
			var strHtml = '<h3>You are on a not-iOS, not-Android device</h3>';
			strHtml += "<p>To add this app to your bookmarks, do whatever it is you need to do to do that.</p>"
			if (strDevice === "ios") {
				strHtml = '<h3>You are on an iOS device</h3><p>To add this app to your home screen, ';
				strHtml += 'tap the bookmark icon in the toolbar below and follow the prompts.</p>';
			} else if (strDevice === "android") {
				strHtml = "<h3>You are on an Android device</h3><p>To add this app to your home screen, ";
				strHtml += "add it as a bookmark and follow the prompts.</p>";
			}
			$("#pageHome .bookmark-popup").html(strHtml).width(intWidth).positionBottomOfViewport().show().click(function(){
				$(this).hide();
				if (dataStorage.isSupported()) {
					dataStorage.add("popup-shown-date", Date.today());
				}
			});
			
			// Need to move it in case of orientation change
			$(document).bind("orientationchange", function() {
				$("#pageHome .bookmark-popup").positionBottomOfViewport();
			})
		}
		
		// Initialize handler for discussions tab 
		$("#pageDiscuss").bind("pageshow", function() {
			
			$.mobile.pageLoading();
			
			
			$().mobyDiscussionManager("userTopicsToHtml",  {
				callbackSuccess : function(strDiscussionHtml) {
					var strHtml = '<ul data-role="listview" data-inset="true" class="mobi-listview">';
					strHtml += strDiscussionHtml;
					strHtml += "</ul>";
					$("#pageDiscuss .view-discussion").html(strHtml);
					$("#pageDiscuss .view-discussion .mobi-listview").listview();
					// fill in the filter
					$().mobyCourseManager({
						callbackSuccess: function(arrCourses) {
							var strHtml = '<select name="select-filter-discussions" id="select-filter-discussions">';
							strHtml += '<option value="all">All</option>';
								
							for (var i = 0; i < arrCourses.length; i++) {
								var strClass = ".course-" + arrCourses[i].id;
								if ($(strClass).length > 0) {
									strHtml += '<option value="'+arrCourses[i].id+'">' +arrCourses[i].title+ '</option>';
								}
							}
							
							strHtml += "</select>";
							
							$("#container-filter-discussions").html(strHtml);
							$("select").selectmenu();
							$("#select-filter-discussions").change(function() {
								var strValue = $(this).val();
								if (strValue === "all") {
									$(".view-discussion .mobi-listview li").show();
									$(".view-discussion .mobi-listview .ui-corner-top").removeClass("ui-corner-top");
									$(".view-discussion .mobi-listview .ui-li-divider:visible:first").addClass("ui-corner-top");
								} else {
									var strClass = ".course-" + strValue;
									var $items = $(strClass);
									if ($items.length > 0) {
										$(".view-discussion .mobi-listview .ui-corner-top").removeClass("ui-corner-top");
										$(".view-discussion .mobi-listview li").hide();
										$items.show();
										$(".view-discussion .mobi-listview .ui-li-divider:visible:first").addClass("ui-corner-top");
									}
									
								}
							})
						}
					});
					$.mobile.pageLoading(true);
				}
			})
			

			
		})
		
		
		 $("body").removeClass("ui-loading");
	}
	
})(jQuery);


var detectDevice = function() {
	var strUserAgent = navigator.userAgent.toLowerCase();
	var strDevice = "other";
	if ((strUserAgent.search("iphone") > -1) || (strUserAgent.search("ipod") >-1)) {
		strDevice = "ios";
	} else if (strUserAgent.search("android") > -1) {
		strDevice = "android";
	}
	return strDevice;
}


		</script>
		
	</head>
	<body class="ui-loading">
		
		<div data-role="page" id="pageHome">

			<div class="layout-header">
				<p class="branding-header-logo">Pearson</p>
				<a class="button-menu">Menu</a>
				<div class="clear"></div>
				<ul data-role="listview" data-inset="true">
					<li><a href="#">Home</a></li>
					<li><a href="#pageProfile" data-transition="flip">My Profile</a></li>
					<li><a href="#">Settings</a></li>
					<li><a href="#" class="menu-logout">Logout</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div data-role="content">
				
				<div data-role="navbar" class="container-navbar">
					<ul>
						<li><a href="#" data-transition="flip" class="ui-btn-active">Home</a></li>
						<li><a href="#pageDiscuss" data-transition="flip">Discuss</a></li>
						<li><a href="#pageClasses" data-transition="flip">Classes</a></li>
						<li><a href="#pagePeople" data-transition="flip">People</a></li>
						<li><a href="#pageProfile" data-transition="flip">Profile</a></li>
					</ul>
				</div>

				<div data-role="controlgroup" data-type="horizontal" class="ui-fluid ui-even-2 subnav">
					<a href="#" data-role="button" class="btn-whatsdue">What's Due</a>
					<a href="#" data-role="button" class="btn-activity">Activity</a>
				</div>

				<div class="view-activity">
					
				</div>
				
				<!--
				<div class="view-activity-template" style="display: none;">
					<ul class="mobi-listview">
						<li data-role="list-divider">Today</li>
						<li id="activity1">
							<a href="#">
								<span class="mobi-activity-title">Ends Today</span>
								<span>Accounting and the Business Environment so here's a title that's really long</span>
								<span class="mobi-course-title">Accounting 1001</span>
								<span class="mobi-course-date">Today</span>
							</a>
						</li>
					</ul>
				</div>
				-->
				
				<div class="view-whatsdue">
					<h3>There is nothing due today.</h3>
				</div>
				
				<div class="bookmark-popup">
				</div>
				
			</div>

			
		</div>
		
		
		
		<div data-role="page" id="pageDiscuss">
			<div class="layout-header">
				<p class="branding-header-logo">Pearson</p>
				<a class="button-menu">Menu</a>
				<div class="clear"></div>
				<ul data-role="listview" data-inset="true">
					<li><a href="#pageHome" data-transition="flip">Home</a></li>
					<li><a href="#pageProfile" data-transition="flip">My Profile</a></li>
					<li><a href="#">Settings</a></li>
					<li><a href="#" class="menu-logout">Logout</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div data-role="content">
				<div data-role="navbar" class="container-navbar">
					<ul>
						<li><a href="#pageHome" data-transition="flip">Home</a></li>
						<li><a href="#pageDiscuss" class="ui-btn-active" data-transition="flip">Discuss</a></li>
						<li><a href="#pageClasses" data-transition="flip">Classes</a></li>
						<li><a href="#pagePeople" data-transition="flip">People</a></li>
						<li><a href="#pageProfile" data-transition="flip">Profile</a></li>
					</ul>
					<div data-role="fieldcontain" id="container-filter-discussions">
					</div>
				</div>
				<div class="view-discussion">
				</div>
				

			</div>
		</div>
		
		<div data-role="page" id="pageClasses">
			<div class="layout-header">
				<p class="branding-header-logo">Pearson</p>
				<a class="button-menu">Menu</a>
				<div class="clear"></div>
				<ul data-role="listview" data-inset="true">
					<li><a href="#pageHome" data-transition="flip">Home</a></li>
					<li><a href="#pageProfile" data-transition="flip">My Profile</a></li>
					<li><a href="#">Settings</a></li>
					<li><a href="#" class="menu-logout">Logout</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div data-role="content">
				<div data-role="navbar" class="container-navbar">
					<ul>
						<li><a href="#pageHome" data-transition="flip">Home</a></li>
						<li><a href="#pageDiscuss" data-transition="flip">Discuss</a></li>
						<li><a href="#pageClasses" data-transition="flip" class="ui-btn-active">Classes</a></li>
						<li><a href="#pagePeople" data-transition="flip">People</a></li>
						<li><a href="#pageProfile" data-transition="flip">Profile</a></li>
					</ul>
				</div>
				<h3>Classes</h3>

			</div>
		</div>

		<div data-role="page" id="pagePeople">
			<div class="layout-header">
				<p class="branding-header-logo">Pearson</p>
				<a class="button-menu">Menu</a>
				<div class="clear"></div>
				<ul data-role="listview" data-inset="true">
					<li><a href="#pageHome" data-transition="flip">Home</a></li>
					<li><a href="#pageProfile" data-transition="flip">My Profile</a></li>
					<li><a href="#">Settings</a></li>
					<li><a href="#" class="menu-logout">Logout</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div data-role="content">
				<div data-role="navbar" class="container-navbar">
					<ul>
						<li><a href="#pageHome" data-transition="flip">Home</a></li>
						<li><a href="#pageDiscuss" data-transition="flip">Discuss</a></li>
						<li><a href="#pageClasses" data-transition="flip">Classes</a></li>
						<li><a href="#pagePeople" class="ui-btn-active" data-transition="flip">People</a></li>
						<li><a href="#pageProfile" data-transition="flip">Profile</a></li>
					</ul>
				</div>
				<h3>People</h3>

			</div>
		</div>

		<div data-role="page" id="pageProfile">
			<div class="layout-header">
				<p class="branding-header-logo">Pearson</p>
				<a class="button-menu">Menu</a>
				<div class="clear"></div>
				<ul data-role="listview" data-inset="true">
					<li><a href="#pageHome" data-transition="flip">Home</a></li>
					<li><a href="#">My Profile</a></li>
					<li><a href="#">Settings</a></li>
					<li><a href="#" class="menu-logout">Logout</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div data-role="content">
				<div data-role="navbar" class="container-navbar">
					<ul>
						<li><a href="#pageHome" data-transition="flip">Home</a></li>
						<li><a href="#pageDiscuss" data-transition="flip">Discuss</a></li>
						<li><a href="#pageClasses" data-transition="flip">Classes</a></li>
						<li><a href="#pagePeople" data-transition="flip">People</a></li>
						<li><a href="#pageProfile" class="ui-btn-active" data-transition="flip">Profile</a></li>
					</ul>
				</div>
				<h3>Profile</h3>

			</div>
		</div>

		<div data-role="page" id="pageActivityDetail">
			<div class="layout-header">
				<p class="branding-header-logo">Pearson</p>
				<a class="button-menu">Menu</a>
				<div class="clear"></div>
				<ul data-role="listview" data-inset="true">
					<li><a href="#pageHome" data-transition="flip">Home</a></li>
					<li><a href="#">My Profile</a></li>
					<li><a href="#">Settings</a></li>
					<li><a href="#" class="menu-logout">Logout</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div data-role="content">
				<div data-role="navbar" class="container-navbar">
					<ul>
						<li><a href="#pageHome" data-transition="flip">Home</a></li>
						<li><a href="#pageDiscuss" data-transition="flip">Discuss</a></li>
						<li><a href="#pageClasses" data-transition="flip">Classes</a></li>
						<li><a href="#pagePeople" data-transition="flip">People</a></li>
						<li><a href="#pageProfile" data-transition="flip">Profile</a></li>
					</ul>
				</div>
				<h3>Activity Detail Page</h3>
				<a data-theme="b" href="#" class="ui-btn-left ui-btn ui-btn-icon-left ui-btn-corner-all ui-shadow ui-btn-up-b" data-rel="back" data-icon="arrow-l"><span class="ui-btn-inner ui-btn-corner-all"><span class="ui-btn-text">Back</span><span class="ui-icon ui-icon-arrow-l ui-icon-shadow"></span></span></a>


			</div>
		</div>


		<iframe id="crossDomainCommunicationFrame" src="" style="display:none"></iframe>
	</body>

</html>